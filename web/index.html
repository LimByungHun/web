<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <!-- <base href="$FLUTTER_BASE_HREF"> -->
  <base href="/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="sign_web">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <meta name="permissions-policy" content="camera=(self)">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>
  <!-- web/index.html -->
<head>
  ...
  <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
  <script>
    // 카메라 권한 요청
    async function requestCameraPermission() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        stream.getTracks().forEach(track => track.stop()); // 권한만 확인하고 스트림은 중지
        console.log('카메라 권한이 허용되었습니다.');
      } catch (error) {
        console.error('카메라 권한 요청 실패:', error);
      }
    }

    // 페이지 로드 시 카메라 권한 요청
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      requestCameraPermission();
    }

    // OpenCV.js 로드 완료 신호
    window.cvReady = new Promise((resolve) => {
      const check = () => {
        if (window.cv && window.cv.Mat) resolve(true);
        else setTimeout(check, 50);
      };
              if (window.cv) {
          window.cv['onRuntimeInitialized'] = () => resolve(true);
        }
      check();
    });

    // 캔버스 RGBA 프레임을 그레이로 변환해 같은 캔버스에 그려주는 예시
    window.cvGray = function(canvas) {
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const srcData = ctx.getImageData(0, 0, w, h);
      const src = cv.matFromImageData(srcData);
      const gray = new cv.Mat();
      cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
      cv.cvtColor(gray, src, cv.COLOR_GRAY2RGBA); // 다시 RGBA로
      cv.imshow(canvas, src);
      src.delete(); gray.delete();
    };
  </script>
</head>

  

  <title>web</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
